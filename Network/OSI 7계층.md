# OSI 7계층

# 탄생 배경

- 기존에는 회사 장비마다 네트워크 장치가 중구난방이라서 호환이 되지 않아 문제가 많았음
- 이에 따라 네트워크를 7계층으로 분리하여 표준화시킴
- `OSI 7계층`

## 계층 분리 이유

- 역할이 분리됨으로써 문제 발생 시 문제의 현상을 분석하여 문제가 생긴 계층을 파악할 수 있음

> PC방에서 오버워치를 하는데 연결이 끊겼다.
> 
> 
> 어디에 문제가 있는지 확인하기 위해서는
> 
> - 모든 PC가 문제가 있다면
> 
> 라우터의 문제(3계층 네트워크 계층)이거나 광랜을 제공하는 회사의 회선 문제(1계층 물리 계층)
> 
> - 한 PC만 문제가 있고, 오버워치 소프트웨어에 문제가 있다면 → 7계층 어플리케이션 계층
> - 오버워치 소프트웨어에 문제가 없고, 스위치에 문제가 있으면 →2계층 데이터링크 계층
> 
> 판단해 다른 계층에 있는 장비나 소프트웨어를 건들이지 않는것이다.
> 

# 작동 원리

![Untitled](https://user-images.githubusercontent.com/22907483/155547853-cf75cf43-fac3-4668-80c4-48baeca18152.png)

- 전송 시 7계층에서 1계층으로 각각의 층마다 인식할 수 있어야 하는 헤더를 붙임 (캡슐화)
- 수신 시 1계층에서 7계층으로 헤더를 떼어냄 (디캡슐화)
- 출발지에서 데이터가 전송될 때 헤더가 추가되는데 2계층(데이터 링크 계층)에서만 오류 제어를 위해 꼬리 부분에 추가됨

# 구성

![Untitled](https://user-images.githubusercontent.com/22907483/155547936-9d907781-3e11-496e-9874-476abd97d4ba.png)

- 응용 계층, 표현 계층, 세션 계층, 전송 계층, 네트워크 계층, 데이터 링크 계층, 물리 계층
- 각 계층은 하위 계층을 사용하고 현 계층의 기능을 포함하여 상위 계층에 제공함

## 물리 계층(Physical Layer)

- 7계층 중 최하위 계층.
- 말 그대로 `하드웨어 전송 기술`로 이루어져있음
- 주로 전기적, 기계적, 기능적인 특성을 이용해 데이터를 전송(전기적, 기계적 신호)
- 데이터는 0과 1의 비트열, 즉 On, Off의 전기적 신호 상태로 이루어져 해당 계층은 단지 데이터를 전달
    
    > 디지털신호는 항상 0과 무한대 값의 주파수를 갖기때문에 상식적인 매체(유선통신에서는 전선)를 통해서 제대로 전송할 수 없습니다.
    따라서 매체가 전송할 수 있는 주파수 범위 내에 들어가도록 신호 형태를 변조할 필요가 있는 것입니다.
    > 
- 단지 데이터 전달의 역할을 할 뿐이라 데이터의 종류, 오류 제어 기능이 없음 (이러한 기능은 데이터 링크 계층에서)
    - 전송하려는(또는 받으려는) 데이터가 무엇인지, 어떤 에러가 있는지 전혀 신경쓰지 않음
- 대표적인 장비로는 `통신 케이블, 리피터, 허브`가 있음

## 데이터 링크 계층(Data-Link Layer)

물리계층을 통해 송수신되는 정보의 오류와 흐름을 관리하여 안전한 정보의 전달을 수행할 수 있도록 도와주는 역할

- 동일한 네트워크 내에서의 전송
- 물리적인 연결을 통하여 인접한 두 장치 간의 `신뢰성 있는 정보 전송`을 담당(Point-To-Point 전송)
- 안전한 정보의 전달이라는 것은 `오류나 재전송`하는 기능이 존재
- 물리 주소인 `MAC 주소`를 통해서 통신
- 데이터 링크 계층에서 데이터 단위는 `프레임(Frame)`
- 장비로는 `브릿지, 스위치`가 있음

→ 브릿지나 스위치를 통해 맥주소를 가지고 물리계층에서 받은 정보를 전달함

## 네트워크 계층(Network Layer)

이 계층의 역할은 경로를 선택하고 주소를 정하고 경로에 따라 패킷을 전달해주는 것(주소부여 : IP, 경로설정 : 라우트) + 데이터를 목적지까지 가장 안전하고 빠르게 전달하는 기능을 담당

- 서로 다른 두 네트워크
- 흔히 아는 IP 주소를 제공하는 계층 (IP주소는 계층적으로 A, B, C, D 클래스로 나눠져있음)
    - IP 주소가 바로 네트워크 계층 헤더에 속함
- `라우팅 기능`을 맡고 있는 계층으로 **목적지까지 가장 안전하고 빠르게 데이터를 보내는 기능**을 가지고 있음(노드를 거칠 때 마다  실행, 최적의 경로를 설정가능)
    - 호스트에다가 IP 번호 부여 해당 도착지 IP까지 최적의 경로를 찾는것
    - 실생활에서 가장 쉽게 볼 수 있는 라우팅 장비 = 공유기
    - 공유기가 라우터는 아니지만 라우터의 NAT 기능을 활성화시킨 것
    - 공유기는 하나의 외부 통신선에서 들어오는 요청을 사설망에 연결되어있는 컴퓨터에게 전달해주는 역할을 함
- 컴퓨터에게 데이터를 전송할 주소를 갖고 있어서 통신가능
- 네트워크 계층에서 데이터 단위는 `패킷(Packet)`
- 장비로는 `라우터, L3 스위치, IP 공유기`가 있음
    - L3 스위치(Layer 3 스위치) : 2계층 장비인 스위치에 라우팅 기능을 장착한 것

## 전송 계층(Transport Layer)

양 끝단(End to End)의 사용자들이 데이터를 주고 받을 수 있게 하는 계층
포트 번호를 사용하여 도착지 컴퓨터의 최종 도착지인 프로세스까지 데이터가 도달하게 하는 모듈

- 대표적으로 자주 사용되는 `TCP, UDP 프로토콜`이 있는 계층
- **TCP**
    - 신뢰성있는 통신을 보장
    - 데이터가 전달되는 과정에서 여러 스위치, 라우터 등등을 거치면서 데이터가 잘못 전달되는 현상이나 전달이 안되는 경우 오류 제어, 흐름 제어를 통해 신뢰성있는 데이터가 전달될 수 있도록 함
    - 연결시 3 way handshaking 방식으로 목적지와 상호 패킷을 교환하여 연결함
    - 연결을 종료할 때는 4 way handshaking 방식 사용
    - 신뢰성 연결과 전달을 보장하는 만큼 중간의 확인 과정을 거치고 연결을 계속 유지해야되기 때문에 그만큼의 리소스가 더 들어감
- **UDP**
    - 비연결형 프로토콜
    - 데이터를 빠르게 전달하는데 초점
    - 목적지에 데이터가 제대로 전달되었는지 확인하지않음, 전송하면 끝
    - 따라서 신뢰성 있는 데이터 전송이 필요할 때보다 스트리밍같이 연속적인 특성을 가지고 있는 서비스에 사용함
- 송신자와 수신자 간의 신뢰성있고 효율적인 데이터를 전송하기 위하여 오류 검출 및 복구, 흐름 제어와 중복 검사 등을 수행 → 세그멘테이션, 흐름제어, 오류제어
    - 세그멘테이션: 상위계층 데이터를 받아서 세그먼트라는 단위로 나누는 것
        - 만약 사용하지 않으면 비디오가 모두 로딩돼야 그 후에 볼 수 있음
        - 하지만 나누면 일부분을 볼 수 있게 됨
        - 연결이 중간에 끊기면 세그멘테이션 안하면 데이터가 다 날아감 손실율이 큼
    - 흐름제어
        - 서로 다른 데이터 전송량을 가진 기기에서 전송량을 낮춰달라고 요구하고 낮추는..
        - 너무 낮으니 좀 높여달라고도 할 수 있음
        - Stop & wait, 슬라이딩 윈도우
    - 오류제어
        - 내가 보낸 데이터가 정확히 오류 손실이 없는지, 오류가 있다면 다시 해당 데이터를 보내주는것
        - FEC, BEC, ARQ
- 데이터 전송을 위해서 `Port 번호`를 사용함
    - 포트 번호는 하나의 컴퓨터에서 동시에 실행되고 있는 프로세스들이 서로 겹치지 않게 가져야하는 정수 값
- 전송 계층에서 데이터 단위는 `세그먼트(Segment)`

## 세션 계층(Session Layer)

세션을 열고 닫고를 제공하는 메커니즘의 계층 + 세션복구
데이터가 통신하기 위한 논리적 연결을 담당

- 세션 계층부터 데이터를 만들어내는 계층
- TCP/IP 세션을 만들고 없애는 책임을 짐
- 통신 장치 간 상호작용 및 동기화를 제공, 오류복구 명령들을 일괄적으로 다룸
- 연결 세션에서 데이터 교환과 에러 발생 시의 복구를 관리
- 대표적으로 `RPC, Socket` 등이 있음

## 표현 계층(Presentation Layer)

데이터의 변환, 압축, 암호화가 일어남

- 코드 간의 번역을 담당하여 사용자 시스템에서 데이터의 형식상 차이를 다루는 부담을 응용계층으로부터 덜어줌(기기간의 인코딩이 다를 수도 있기 때문에...)
    - MIME 인코딩, 암호화 등의 동작이 이 계층에서 이루어짐
    - 데이터를 어떻게 표현할지, 데이터의 압축, 인코딩 등의 역할을 하는 계층
    - EBCDIC 인코딩 → ASCII로 인코딩된 파일로 바꿔주기, 해당 데이터가 text, gif, jpg인지 등의 구분
1. 송신자에서 온 데이터를 해석하기 위한 응용계층 데이터 부호화, 변화
2. 수신자에서 데이터의 압축을 풀수 있는 방식으로 된 데이터 압축
3. 데이터의 암호화와 복호화(MIME 인코딩이나 암호화 등의 동작이 표현계층에서 이루어짐. EBCDIC로 인코딩된 파일을 ASCII 로 인코딩된 파일로 바꿔주는 것이 한가지 예임)

## 응용 계층(Application Layer)

- 사용자와 가장 밀접한 계층으로 인터페이스 역할
- 대표적으로 `HTTP, FTP, SMTP, Telenet 등의 프로토콜`이 이 계층에 속함
- 우리가 사용하는 브라우저나 메일 프로그램은 프로토콜을 보다 쉽게 사용하게 해주는 응용프로그램
- 응용 프로세스 간의 정보 교환을 담당
- 모든 통신의 양 끝단은 HTTP와 같은 프로토콜 O, 응용 프로그램 X
